<html>
<head>
<title>Youssef Gamil</title>
</head>

<body>
<canvas id="canvas" >Original image Here</canvas>
<canvas id="outputCanvas" >Output</canvas>
<canvas id="outputCanvas2" >Output</canvas>

<script type="text/javascript">


var img = new Image();


img.onload = function(ev){

	var canvas = document.getElementById("canvas");
	var c = canvas.getContext("2d");

//    im = ev.target; // the image, assumed to be 200x200

    // read the width and height of the canvas
    canvas.width=img.width;
    canvas.height=img.height;

    // stamp the image on the left of the canvas:
    c.drawImage(img, 0, 0);

	console.log("drawing image..");
    // get all canvas pixel data
    var imageData = c.getImageData(0, 0, canvas.width, canvas.height);
    
    //Output it to the "outputCanvas"
	var out=document.getElementById("outputCanvas");
//	var outData=out.getContext("2d").createImageData(img.width,img.height);
	out.width=img.width;
	out.height=img.height;
	
	var filter3x3=[[1/9,1/9,1/9],[1/9,1/9,1/9],[1/9,1/9,1/9]];

	for(r=0;r<img.width;r++)
		for(c=0;c<img.height;c++)
		{
			var avg=0;
			
			for(dr=-1;dr<=1;dr++)
				for(dc=-1;dc<=1;dc++)
						if(		(4*( (r+dr)*img.width+(c+dc) )) <imageData.data.length 
								&&		(4*( (r+dr)*img.width+(c+dc) )) >=0)
								avg+=filter3x3[dr+1][dc+1] * imageData.data[(4*( (r+dr)*img.width+(c+dc) ))];
			//Red layer
			imageData.data[4*(r*img.width+c)]=avg;
			//Green layer
			imageData.data[4*(r*img.width+c)+1]=avg;
			//Blue layer
			imageData.data[4*(r*img.width+c)+2]=avg;			
			//Alpha layer
//			imageData.data[4*(r*img.width+c)+3]=avg;

		}
	out.getContext("2d").putImageData(imageData, 0, 0);
	
	
	// DO THE 5x5 FILTER
	
	var filter5x5=[[1/25,1/25,1/25,1/25,1/25],[1/25,1/25,1/25,1/25,1/25],[1/25,1/25,1/25,1/25,1/25],[1/25,1/25,1/25,1/25,1/25],[1/25,1/25,1/25,1/25,1/25]];
	
	for(r=0;r<img.width;r++)
		for(c=0;c<img.height;c++)
		{
			var avg=0;
			
			for(dr=-2;dr<=2;dr++)
				for(dc=-2;dc<=2;dc++)
						if(		(4*( (r+dr)*img.width+(c+dc) )) <imageData.data.length 
								&&		(4*( (r+dr)*img.width+(c+dc) )) >=0)
								avg+=filter5x5[dr+2][dc+2] * imageData.data[(4*( (r+dr)*img.width+(c+dc) ))];
			//Red layer
			imageData.data[4*(r*img.width+c)]=avg;
			//Green layer
			imageData.data[4*(r*img.width+c)+1]=avg;
			//Blue layer
			imageData.data[4*(r*img.width+c)+2]=avg;			
			//Alpha layer
//			imageData.data[4*(r*img.width+c)+3]=avg;

		}
		var out2=document.getElementById("outputCanvas2");
		out2.width=img.width;
		out2.height=img.height;
		out2.getContext("2d").putImageData(imageData, 0, 0);
    // put pixel data on canvas
//    c.putImageData(imageData, 0, 0);

};



img.src = "t.jpg";// must be in same domain,otherwise a Cross-orgin" exception!

</script>

</body>
</html>